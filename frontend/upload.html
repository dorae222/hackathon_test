<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì§„ ì—…ë¡œë“œ - ë‚˜ì˜ ìš´ëª…ì˜ ê°•ì•„ì§€ ì°¾ê¸°</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
        html, body { height: 100%; margin: 0; font-family: 'Pretendard', sans-serif; background-color: #FFFBF5; display: flex; justify-content: center; align-items: center; }
        .screen-container { background-color: white; border-radius: 20px; padding: 30px 40px; width: 100%; max-width: 380px; box-sizing: border-box; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.07); text-align: center; }
        .progress-bar { font-size: 14px; color: #aaa; text-align: center; margin-bottom: 25px; font-weight: 500; }
        .progress-bar span { font-weight: bold; color: #FF7A00; }
        .encouragement-text { font-size: 16px; color: #555; line-height: 1.6; margin-bottom: 25px; }
        .upload-box { border: 2px dashed #ccc; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px; cursor: pointer; transition: background-color 0.2s; min-height: 250px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .upload-box:hover { background-color: #f9f9f9; }
        .upload-box .icon { font-size: 40px; color: #FF7A00; margin-bottom: 10px; }
        .upload-box p { font-size: 16px; font-weight: 500; color: #333; margin-bottom: 20px; }
        .upload-btn { display: inline-block; padding: 12px 25px; border: none; border-radius: 8px; background-color: #555; color: white; font-size: 15px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .upload-btn:hover { background-color: #333; }
        .privacy-note { font-size: 13px; color: #888; }
        #image-preview { max-width: 100%; max-height: 250px; border-radius: 8px; }
        #next-btn { display: none; width: 100%; padding: 16px; border: none; border-radius: 12px; background-color: #FF7A00; color: white; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="screen-container">
        <div class="progress-bar">1ë‹¨ê³„ â†’ <span>2ë‹¨ê³„: AI ë‹®ì€ê¼´ ë¶„ì„</span> â†’ 3ë‹¨ê³„</div>
        <div class="upload-box" id="upload-box" onclick="document.getElementById('fileInput').click()">
            <div id="initial-content">
                <div class="icon">ğŸ“·</div>
                <p><strong>ë‹¹ì‹ ê³¼ ë‹®ì€ ìš´ëª…ì˜ ì•„ì´ë¥¼ ì°¾ê¸° ìœ„í•´<br>ì •ë©´ ì–¼êµ´ ì‚¬ì§„ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.</strong></p>
                <button class="upload-btn" type="button">ì‚¬ì§„ ì„ íƒí•˜ê¸°</button>
            </div>
            <img id="image-preview" src="#" alt="ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€">
        </div>
        <p class="privacy-note">â“˜ ì‚¬ì§„ì€ ë‹®ì€ê¼´ ë¶„ì„ì—ë§Œ ì‚¬ìš©ë˜ë©°, ë¶„ì„ í›„ ì¦‰ì‹œ ì„œë²„ì—ì„œ ì™„ì „íˆ íê¸°ë¼ìš”.</p>
        <button id="next-btn" type="button">AIë¡œ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
        <input type="file" id="fileInput" accept="image/*" style="display: none;">
    </div>

    <script>
        const AI_BASE = '/ai';
        const fileInput = document.getElementById('fileInput');
        const uploadBox = document.getElementById('upload-box');
        const initialContent = document.getElementById('initial-content');
        const imagePreview = document.getElementById('image-preview');
        const nextBtn = document.getElementById('next-btn');

        imagePreview.style.display = 'none';
        let selectedFile = null;

        fileInput.addEventListener('change', function(){
            const file = this.files[0];
            if (!file) return;
            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                initialContent.style.display = 'none';
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                uploadBox.style.padding = '10px';
                uploadBox.style.borderStyle = 'solid';
                nextBtn.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        nextBtn.addEventListener('click', async () => {
            if (!selectedFile){
                alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.');
                return;
            }
            const form = new FormData();
            form.append('image', selectedFile);
            try{
                const resp = await fetch(`${AI_BASE}/classify?top_k=3`, { method: 'POST', body: form });
                if (!resp.ok) throw new Error('ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨');
                const data = await resp.json();
                sessionStorage.setItem('classifyResult', JSON.stringify(data));
            } catch (e){
                console.warn('ë¶„ì„ ì‹¤íŒ¨, ì„ì˜ ì¶”ì²œìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.', e);
                sessionStorage.removeItem('classifyResult');
            }
            window.location.href = '/analyzing.html';
        });
    </script>
</body>
</html>