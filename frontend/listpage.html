<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì¶”ì²œ ê²°ê³¼ - ë‚˜ì˜ ìš´ëª…ì˜ ê°•ì•„ì§€ ì°¾ê¸°</title>
    <style>
       @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

        /* === 1. ë°•ìŠ¤ ëª¨ë¸ ë° í˜ì´ì§€ ê³ ì • (ì±„íŒ…ë°©ê³¼ ë™ì¼í•œ êµ¬ì¡°) === */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* í˜ì´ì§€ ì „ì²´ ìŠ¤í¬ë¡¤ ë§‰ê¸° */
            font-family: 'Pretendard', sans-serif;
            background-color: #FFFBF5; 
        }

        /* === 2. ìŠ¤í¬ë¡¤ì´ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆë¡œ ë³€ê²½ === */
        .screen-container {
            width: 100%;
            max-width: 380px;
            height: 100%;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow-y: scroll; /* ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë§Œ ìŠ¤í¬ë¡¤ë˜ë„ë¡ ì„¤ì • */
            padding: 30px 20px;

            /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ì±„íŒ…ë°©ê³¼ ë™ì¼) */
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .screen-container::-webkit-scrollbar {
            display: none;
        }
        
        /* ì´í•˜ ìŠ¤íƒ€ì¼ì€ ê±°ì˜ ë™ì¼ */
        .header-title {
            font-size: 24px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 25px;
            color: #333;
            flex-shrink: 0; /* ìŠ¤í¬ë¡¤ ë˜ì–´ë„ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
        }
        .result-card {
            background-color: #ffffff;
            border: 1px solid #eee;
            border-radius: 18px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            overflow: hidden;
            transition: transform 0.2s ease-in-out;
        }
        .result-card:hover {
            transform: translateY(-5px);
        }
        .result-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        .card-content { padding: 20px; }
        .card-content h3 { margin-top: 0; margin-bottom: 15px; font-size: 22px; font-weight: bold; text-align: center; }
        .similarity-score { background-color: #FFF5E1; border-radius: 10px; padding: 12px; font-weight: bold; text-align: center; margin-bottom: 18px; font-size: 16px; }
        .similarity-score .label { font-size: 13px; font-weight: 500; display: block; margin-top: 4px; }
        .matching-points { font-size: 14px; text-align: center; margin-bottom: 20px; background-color: #f7f7f7; padding: 12px; border-radius: 10px; }
        .matching-points strong { display: block; margin-bottom: 8px; font-size: 15px; }
        .matching-points .tag { background-color: #e7e7e7; border-radius: 5px; padding: 4px 10px; font-size: 13px; font-weight: 500; margin: 0 3px; display: inline-block; }
        .btn { display: block; width: 100%; padding: 16px; border: none; border-radius: 12px; background-color: #FF7A00; color: white; font-size: 18px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; }
        .btn:hover { background-color: #E66A00; }
    </style>
</head>
<body>
    <div class="screen-container">
        <h1 class="header-title">AIê°€ ì°¾ì•„ì¤€<br>ë‹¹ì‹ ì˜ ìš´ëª…ì ì¸ ì¹œêµ¬ë“¤ì´ì—ìš”!</h1>
        <div id="result-container"></div>
    </div>

    <script>
        const AI_BASE = '/ai';
        function findField(infoArr, key){
            if (!Array.isArray(infoArr)) return '';
            for (const row of infoArr){
                if (row[0] === key) return row[1] || '';
                if (row[2] === key) return row[3] || '';
            }
            return '';
        }
        async function load(){
            const wrap = document.getElementById('result-container');
            wrap.innerHTML = '';
            const res = await fetch(`${AI_BASE}/animals`);
            const animals = await res.json();

            // If classifyResult exists, try to pick a best match by breed name
            let best = animals[0];
            let simText = 'ë‹®ì€ê¼´ ì§€ìˆ˜ 70% !';
            let simLabel = 'AI ë¶„ì„ì— ê¸°ë°˜í•œ ì¶”ì²œì…ë‹ˆë‹¤.';
            try{
                const cls = JSON.parse(sessionStorage.getItem('classifyResult')||'null');
                if (cls && Array.isArray(cls.top) && cls.top.length>0){
                    const topBreed = cls.top[0];
                    simText = `ë‹®ì€ê¼´ ì§€ìˆ˜ ${(cls.probs && cls.probs[0] ? Math.round(cls.probs[0]*100) : 76)}% !`;
                    simLabel = `${topBreed} íŠ¹ì„±ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¶”ì²œí–ˆì–´ìš”.`;
                    const idx = animals.findIndex(a => (findField(a.info,'í’ˆì¢…')||'').includes(topBreed));
                    if (idx >= 0) best = animals[idx];
                }
            }catch{ /* ignore */ }

            const name = findField(best.info,'ì´ë¦„') || 'ì´ë¦„ ë¯¸ìƒ';
            const breed = findField(best.info,'í’ˆì¢…') || 'í’ˆì¢… ë¯¸ìƒ';
            const age = findField(best.info,'ë‚˜ì´(ì¶”ì •)') || '';
            const gender = findField(best.info,'ì„±ë³„') || '';
            const img = best.thumbnail || (best.gallery && best.gallery[0]) || (best.images_mapped && best.images_mapped[0]) || (best.images && best.images[0]) || '';
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <img src="${img}" alt="ê°•ì•„ì§€ ì‚¬ì§„" onerror="this.onerror=null; this.src='/assets/dog-placeholder.svg'">
                <div class="card-content">
                    <h3>${name} (${age?age+', ':''}${breed}${gender?`, ${gender}`:''})</h3>
                    <div class="similarity-score" style="background-color:#E6F0FF;">âœ¨ ${simText}<span class="label">${simLabel}</span></div>
                    <div class="matching-points">
                        <strong>âœ”ï¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë§¤ì¹­ í¬ì¸íŠ¸</strong>
                        <div>
                            <span class="tag">#í™œë™ëŸ‰ ì ë‹¹</span>
                            <span class="tag">#ê°€ì¡±ì¹œí™”</span>
                        </div>
                    </div>
                    <button class="btn" id="chat-btn">${name}ì™€ ëŒ€í™”í•´ë³´ê¸° ğŸ’¬</button>
                </div>`;
            wrap.appendChild(card);
            document.getElementById('chat-btn').addEventListener('click', ()=>{
                window.location.href = `/chatbot.html?id=${best.id}`;
            });
        }
        document.addEventListener('DOMContentLoaded', load);
    </script>
</body>
</html>